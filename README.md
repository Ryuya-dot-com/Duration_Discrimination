# Duration Discrimination

3つの音のうち、1つだけが違う Duration Discrimination Test (持続時間弁別テスト) です。違う音は必ず 1 番目か 3 番目で、参加者は「1」か「3」を答えます。音の長さの差は `Stimuli/1.flac` を基準に、`Stimuli/2.flac` 以降で段階的に変えています。練習では差が大きく分かるように刺激 1 と 100 を使います。

## 実行方法

- 参加者IDを入力し、説明画面へ。
- 「練習を開始」で 3 試行の練習を実施（刺激 1 と 100 を使用）。各試行後に正誤フィードバックが出ます。練習完了後に「本番を開始」が有効になります。
- 本番は 3 つの音が順に流れ、再生が終わったら 1/3 ボタンが押せます。最大 75 試行か「折り返し」が 7 回に達したら終了し、自動で CSV (`<ID>_duration_discrimination.csv`) をダウンロードします。完了画面から再ダウンロードも可能です。

## 主要パラメータ（`duration_discrimination.js`）

- `startingStep = 51`（開始ステップ）
- `maxTrials = 75`
- `numSteps = 101`（`Stimuli/1.flac`〜`Stimuli/101.flac` を読み込み）
- `targetReversals = 7`（折り返し 7 回で終了）
- ステップサイズ: `[10, 5, 2, 1, 1, 1, 1, 1]`
- 刺激間隔: 再生間 500ms、再生完了から 500ms 後に回答ボタン表示、回答後 1000ms で次試行。
- 練習: `practiceConfig.trials = 3`（刺激は 1 と 100 固定、正誤フィードバックあり）

## CSVにおける列の意味

- `subject_id` : 参加者ID（入力した文字列）
- `trial` : 試行番号（1 から）
- `stimulus_step` : その試行で使った音の差の大きさ (`i.flac` の i)
- `odd_position` : 違う音があった位置（1 か 3）
- `correct_answer` : 正解（'1' または '3'）
- `response` : 参加者の回答（'1' または '3'）
- `correct` : 正誤（1=正解, 0=不正解）
- `rt_ms` : 反応時間（ms）。3 音の再生が終わってボタンが押せるようになってから押すまで。
- `num_reversals_after` : 「折り返し」が累計で何回になったか。折り返し=前の試行と正誤が逆転した回（例: 正解すべきが1なのに3を押して不正解になり、前の試行は正解だった→1 回カウント）。
- `step_before` : 難易度更新前のステップ値
- `step_after` : 更新後のステップ値（2〜101 に収まるように調整）
- `step_size_used` : その試行で上下に動かしたステップ幅
- `mean_reversal_so_far` : 2 回目以降の折り返しで記録したステップ値の平均（データが足りない間は空欄）

## 階段法（難易度調整）の流れ

- 1-up/2-down 型。正解が続くと差を小さくし、不正解で差を大きくする。
- 正誤が切り替わった（当たり→外れ、または外れ→当たりで規則を満たした）タイミングを「折り返し」と数え、折り返し地点のステップ値の平均（2 回目以降）をテスト終了時に閾値として表示します。
